<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>SmartTV Remote</title>
    <style>
      body {
        font-family: system-ui;
        margin: 0;
        display: flex;
        min-height: 100vh;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #0f1419 0%, #1a252f 50%, #2c5364 100%);
        color: white;
      }
      
      .remote-container {
        background: rgba(255,255,255,0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        border: 1px solid rgba(255,255,255,0.1);
      }
      
      .remote-title {
        text-align: center;
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 25px;
        color: #66d9ef;
      }
      
      .pad {
        display: grid;
        gap: 15px;
        grid-template-columns: repeat(3, 70px);
        grid-template-rows: repeat(4, 50px);
      }
      
      button {
        font-size: 16px;
        font-weight: 600;
        border-radius: 12px;
        border: 1px solid rgba(255,255,255,0.2);
        background: rgba(255,255,255,0.1);
        color: white;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      button:hover {
        background: rgba(102,217,239,0.2);
        border-color: rgba(102,217,239,0.5);
        transform: scale(1.05);
      }
      
      button:active {
        transform: scale(0.95);
      }
      
      /* Navigation Cross Layout */
      .nav-up { grid-column: 2; grid-row: 1; }
      .nav-left { grid-column: 1; grid-row: 2; }
      .nav-ok { grid-column: 2; grid-row: 2; background: rgba(102,217,239,0.15); }
      .nav-right { grid-column: 3; grid-row: 2; }
      .nav-down { grid-column: 2; grid-row: 3; }
      
      /* Action buttons */
      .btn-back { grid-column: 1; grid-row: 1; }
      .btn-home { grid-column: 3; grid-row: 1; }
      .btn-play { grid-column: 1; grid-row: 3; }
      .btn-menu { grid-column: 3; grid-row: 3; }
      
      /* Volume row */
      .vol-down { grid-column: 1; grid-row: 4; }
      .vol-up { grid-column: 3; grid-row: 4; }

      /* Trackpad */
      .trackpad { 
        grid-column: 2; grid-row: 4; 
        width: 60px; height: 50px; 
        border-radius: 14px; 
        background: rgba(255,255,255,0.08); 
        border: 1px solid rgba(255,255,255,0.2);
        box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);
        display: flex; align-items: center; justify-content: center;
        user-select: none; touch-action: none;
        font-size: 12px; color: rgba(255,255,255,0.7);
      }
      .trackpad.active { background: rgba(102,217,239,0.15); border-color: rgba(102,217,239,0.5); }
      .wide { grid-column: span 3; }
    </style>
  </head>
  <body>
    <div class="remote-container">
      <div class="remote-title">üì± SmartTV Remote</div>
      <div class="pad">
        <!-- Row 1: Back, Up, Home -->
        <button class="btn-back" data-cmd="nav:back" title="Back">‚ü≤</button>
        <button class="nav-up" data-cmd="nav:up" title="Up">‚ñ≤</button>
        <button class="btn-home" data-cmd="home" title="Home">üè†</button>
        
        <!-- Row 2: Left, OK, Right -->
        <button class="nav-left" data-cmd="nav:left" title="Left">‚óÄ</button>
        <button class="nav-ok" data-cmd="nav:ok" title="OK">OK</button>
        <button class="nav-right" data-cmd="nav:right" title="Right">‚ñ∂</button>
        
        <!-- Row 3: Play, Down, Menu -->
        <button class="btn-play" data-cmd="play:toggle" title="Play/Pause">‚èØ</button>
        <button class="nav-down" data-cmd="nav:down" title="Down">‚ñº</button>
        <button class="btn-menu" data-cmd="menu" title="Menu">‚ò∞</button>
        
        <!-- Row 4: Volume Controls + Trackpad in center -->
        <button class="vol-down" data-cmd="vol:down" title="Volume Down">üîâ</button>
        <div class="trackpad" id="trackpad">Touch</div>
        <button class="vol-up" data-cmd="vol:up" title="Volume Up">üîä</button>
      </div>
    </div>
    
    <script>
      const proto = location.protocol === 'https:' ? 'wss' : 'ws'
      const ws = new WebSocket(`${proto}://${location.host}`)
      
      function send(cmd, payload) { 
        if (ws.readyState === 1) {
          ws.send(JSON.stringify({cmd, payload}))
          console.log('Sent command:', cmd, payload)
        }
      }
      
      // Add visual feedback on button press
      document.querySelectorAll('button').forEach(button => {
        button.addEventListener('click', () => {
          send(button.dataset.cmd)
          
          // Visual feedback
          button.style.background = 'rgba(102,217,239,0.4)'
          setTimeout(() => {
            button.style.background = ''
          }, 200)
        })
      })
      
      // Trackpad logic
      const pad = document.getElementById('trackpad')
      let startX = 0, startY = 0, lastX = 0, lastY = 0, moved = false
      let lastSent = 0
      const throttleMs = 40

      function begin(x, y){
        startX = lastX = x; startY = lastY = y; moved = false
        pad.classList.add('active')
      }
      function move(x, y){
        const dx = x - lastX
        const dy = y - lastY
        const now = Date.now()
        if (Math.abs(dx) + Math.abs(dy) > 0 && now - lastSent > throttleMs){
          lastSent = now
          // invert dy to match natural scrolling (finger up => content down)
          send('pad:move', { dx: Math.round(dx), dy: Math.round(-dy) })
          lastX = x; lastY = y; moved = true
        }
      }
      function end(x, y){
        pad.classList.remove('active')
        const totalDx = x - startX
        const totalDy = y - startY
        if (!moved || (Math.abs(totalDx) < 8 && Math.abs(totalDy) < 8)){
          send('pad:click')
        }
      }

      pad.addEventListener('touchstart', (e)=>{
        const t = e.touches[0]; begin(t.clientX, t.clientY)
      }, {passive: true})
      pad.addEventListener('touchmove', (e)=>{
        const t = e.touches[0]; move(t.clientX, t.clientY)
      }, {passive: true})
      pad.addEventListener('touchend', (e)=>{
        const t = e.changedTouches[0] || {clientX: lastX, clientY: lastY}; end(t.clientX, t.clientY)
      })

      // Mouse fallback
      pad.addEventListener('mousedown', (e)=> begin(e.clientX, e.clientY))
      window.addEventListener('mousemove', (e)=> {
        if (pad.classList.contains('active')) move(e.clientX, e.clientY)
      })
      window.addEventListener('mouseup', (e)=> {
        if (pad.classList.contains('active')) end(e.clientX, e.clientY)
      })
      
      // Connection status
      ws.onopen = () => console.log('Remote connected')
      ws.onclose = () => console.log('Remote disconnected')
      ws.onerror = (e) => console.error('Remote error:', e)
    </script>
  </body>
</html>