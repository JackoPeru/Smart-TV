<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>SmartTV Remote</title>
    <style>
      * { box-sizing: border-box; }
      body {
        font-family: system-ui;
        margin: 0;
        display: flex;
        min-height: 100vh;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #0f1419 0%, #1a252f 50%, #2c5364 100%);
        color: white;
      }
      
      .remote-container {
        background: rgba(255,255,255,0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        border: 1px solid rgba(255,255,255,0.1);
        width: min(520px, 100vw - 24px);
        margin: 12px;
      }
      
      .remote-title {
        text-align: center;
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 25px;
        color: #66d9ef;
      }
      
      .pad {
        display: grid;
        gap: 15px;
        grid-template-columns: repeat(3, minmax(96px, 1fr));
        grid-template-rows: 84px 84px 84px 200px 72px;
        justify-content: center;
      }
      
      button {
        font-size: 18px;
        font-weight: 600;
        border-radius: 14px;
        border: 1px solid rgba(255,255,255,0.2);
        background: rgba(255,255,255,0.1);
        color: white;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        user-select: none;
      }
      
      button:hover {
        background: rgba(102,217,239,0.2);
        border-color: rgba(102,217,239,0.5);
        transform: scale(1.05);
      }
      
      button:active {
        transform: scale(0.95);
      }
      
      /* Navigation Cross Layout */
      .nav-up { grid-column: 2; grid-row: 1; }
      .nav-left { grid-column: 1; grid-row: 2; }
      .nav-ok { grid-column: 2; grid-row: 2; background: rgba(102,217,239,0.15); }
      .nav-right { grid-column: 3; grid-row: 2; }
      .nav-down { grid-column: 2; grid-row: 3; }
      
      /* Action buttons */
      .btn-back { grid-column: 1; grid-row: 1; }
      .btn-home { grid-column: 3; grid-row: 1; }
      .btn-play { grid-column: 1; grid-row: 3; }
      .btn-menu { grid-column: 3; grid-row: 3; }
      
      /* Volume row */
      .vol-down { grid-column: 1; grid-row: 5; height: 64px; }
      .vol-up { grid-column: 3; grid-row: 5; height: 64px; }
      .btn-back2 { grid-column: 2; grid-row: 5; height: 64px; }

      /* Trackpad - dedicated full-width row */
      .trackpad { 
        grid-column: 1 / -1; grid-row: 4; 
        width: 100%; height: 200px; 
        border-radius: 18px; 
        background: rgba(255,255,255,0.08); 
        border: 1px solid rgba(255,255,255,0.2);
        box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);
        display: flex; align-items: center; justify-content: center;
        user-select: none; touch-action: none;
        font-size: 14px; color: rgba(255,255,255,0.8);
        padding: 8px; text-align: center;
      }
      .trackpad.active { background: rgba(102,217,239,0.15); border-color: rgba(102,217,239,0.5); }
      .hint { font-size: 12px; opacity: 0.75; margin-top: 8px; text-align: center; }

      /* Responsive tweaks */
      @media (max-width: 420px) {
        .remote-container { padding: 16px; }
        .pad { gap: 12px; grid-template-rows: 72px 72px 72px 170px 60px; }
        .trackpad { height: 170px; }
        button { font-size: 16px; }
      }
    </style>
  </head>
  <body>
    <div class="remote-container">
      <div class="remote-title">üì± SmartTV Remote</div>
      <div class="pad">
        <!-- Row 1: Back, Up, Home -->
        <button class="btn-back" data-cmd="nav:back" title="Indietro">‚ü≤</button>
        <button class="nav-up" data-cmd="nav:up" title="Su">‚ñ≤</button>
        <button class="btn-home" data-cmd="home" title="Home">üè†</button>
        
        <!-- Row 2: Left, OK, Right -->
        <button class="nav-left" data-cmd="nav:left" title="Sinistra">‚óÄ</button>
        <button class="nav-ok" data-cmd="nav:ok" title="OK">OK</button>
        <button class="nav-right" data-cmd="nav:right" title="Destra">‚ñ∂</button>
        
        <!-- Row 3: Play, Down, Menu -->
        <button class="btn-play" data-cmd="play:toggle" title="Play/Pausa">‚èØ</button>
        <button class="nav-down" data-cmd="nav:down" title="Gi√π">‚ñº</button>
        <button class="btn-menu" data-cmd="menu" title="Menu">‚ò∞</button>
        
        <!-- Row 4: Trackpad full width -->
        <div class="trackpad" id="trackpad">
          Trascina per muovere il cursore
          <br/>Due dita per scorrere
        </div>

        <!-- Row 5: Volume Controls -->
        <button class="vol-down" data-cmd="vol:down" title="Volume -">üîâ</button>
        <button class="btn-back2" data-cmd="nav:back" title="Torna indietro">‚¨Ö Indietro</button>
        <button class="vol-up" data-cmd="vol:up" title="Volume +">üîä</button>
      </div>
      <div class="hint">Suggerimento: con il mouse puoi usare la rotellina sopra il trackpad per scorrere</div>
    </div>
    
    <script>
      const proto = location.protocol === 'https:' ? 'wss' : 'ws'
      const ws = new WebSocket(`${proto}://${location.host}`)
      
      function send(cmd, payload) { 
        if (ws.readyState === 1) {
          ws.send(JSON.stringify({cmd, payload}))
          console.log('Sent command:', cmd, payload)
        }
      }
      
      // Add visual feedback on button press
      document.querySelectorAll('button').forEach(button => {
        button.addEventListener('click', () => {
          send(button.dataset.cmd)
          
          // Visual feedback
          button.style.background = 'rgba(102,217,239,0.4)'
          setTimeout(() => {
            button.style.background = ''
          }, 200)
        })
      })
      
      // Trackpad logic (bigger + smoother + two-finger scroll)
      const pad = document.getElementById('trackpad')
      let mode = 'move' // 'move' or 'scroll'
      let startX = 0, startY = 0, lastX = 0, lastY = 0, moved = false
      let lastSent = 0
      const throttleMs = 24
      const moveSensitivity = 1.2 // cursor
      const scrollSensitivity = 1.1 // scrolling

      function begin(x, y, m='move'){
        mode = m
        startX = lastX = x; startY = lastY = y; moved = false
        pad.classList.add('active')
      }
      function move(x, y){
        const dx = x - lastX
        const dy = y - lastY
        const now = Date.now()
        if (now - lastSent > throttleMs){
          lastSent = now
          if (mode === 'scroll'){
            // Natural scrolling: dita in su => contenuto gi√π
            send('pad:scroll', { dx: Math.round(dx * scrollSensitivity), dy: Math.round(-dy * scrollSensitivity) })
          } else {
            send('pad:move', { dx: Math.round(dx * moveSensitivity), dy: Math.round(-dy * moveSensitivity) })
          }
          lastX = x; lastY = y; moved = true
        }
      }
      function end(x, y){
        pad.classList.remove('active')
        if (mode === 'move'){
          const totalDx = x - startX
          const totalDy = y - startY
          if (!moved || (Math.abs(totalDx) < 8 && Math.abs(totalDy) < 8)){
            send('pad:click')
          }
        }
        mode = 'move'
      }

      // Touch handlers
      pad.addEventListener('touchstart', (e)=>{
        if (e.touches.length >= 2){
          // usa il baricentro delle due dita per lo scroll
          const x = (e.touches[0].clientX + e.touches[1].clientX) / 2
          const y = (e.touches[0].clientY + e.touches[1].clientY) / 2
          begin(x, y, 'scroll')
        } else {
          const t = e.touches[0]; begin(t.clientX, t.clientY, 'move')
        }
      }, {passive: true})
      pad.addEventListener('touchmove', (e)=>{
        if (mode === 'scroll' && e.touches.length >= 2){
          const x = (e.touches[0].clientX + e.touches[1].clientX) / 2
          const y = (e.touches[0].clientY + e.touches[1].clientY) / 2
          move(x, y)
        } else {
          const t = e.touches[0]; move(t.clientX, t.clientY)
        }
      }, {passive: true})
      pad.addEventListener('touchend', (e)=>{
        const t = e.changedTouches[0] || {clientX: lastX, clientY: lastY}; end(t.clientX, t.clientY)
      })

      // Mouse fallback
      pad.addEventListener('mousedown', (e)=> begin(e.clientX, e.clientY, 'move'))
      window.addEventListener('mousemove', (e)=> {
        if (pad.classList.contains('active')) move(e.clientX, e.clientY)
      })
      window.addEventListener('mouseup', (e)=> {
        if (pad.classList.contains('active')) end(e.clientX, e.clientY)
      })
      // Wheel to scroll when hovering the pad
      pad.addEventListener('wheel', (e)=>{
        e.preventDefault()
        send('pad:scroll', { dx: Math.round(e.deltaX), dy: Math.round(e.deltaY) })
      }, { passive: false })
      
      // Connection status
      ws.onopen = () => console.log('Remote connected')
      ws.onclose = () => console.log('Remote disconnected')
      ws.onerror = (e) => console.error('Remote error:', e)
    </script>
  </body>
</html>